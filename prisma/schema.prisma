generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

// USER ROLES
enum Role {
  ADMIN
  GUEST
  ORGANIZATION
  TEACHER
  STUDENT
}

// NOTIFICATIONS
enum NotificationUserType {
  ORGANIZATION
  TEACHER
  STUDENT
}

enum NotificationType {
  ORGANIZATION_INVITE_TEACHER
  ORGANIZATION_INVITE_STUDENT
}

enum NotificationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

// DATABASE MODELS
model Profile {
  id      String @id @unique @default(cuid())
  kindeId String @unique
  role    Role   @default(GUEST)

  name    String  @db.VarChar(255)
  email   String  @unique @db.VarChar(255)
  picture String? @default("/default-user-avatar.png") @db.VarChar(255)

  organizations Organization[]
  teachers      Teacher[]
  students      Student[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Organization {
  id String @id @unique @default(cuid())

  name    String @db.VarChar(255)
  address String @db.VarChar(255)
  phone   String @db.VarChar(255)
  city    String @db.VarChar(255)
  state   String @db.VarChar(255)
  country String @db.VarChar(255)
  email   String @unique @db.VarChar(255)

  profileId String
  profile   Profile @relation(fields: [profileId], references: [kindeId])

  teachers   OrganizationTeacher[]
  students   OrganizationStudent[]
  classrooms Classroom[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([profileId], name: "profileId")
  @@map("organizations")
}

model Teacher {
  id String @id @unique @default(cuid())

  name    String @db.VarChar(255)
  address String @db.VarChar(255)
  phone   String @db.VarChar(255)
  city    String @db.VarChar(255)
  state   String @db.VarChar(255)
  country String @db.VarChar(255)
  email   String @unique @db.VarChar(255)

  profileId String
  profile   Profile @relation(fields: [profileId], references: [kindeId])

  organizations OrganizationTeacher[]

  classrooms Classroom[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([profileId], name: "profileId")
  @@map("teachers")
}

model OrganizationTeacher {
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  teacherId String
  teacher   Teacher @relation(fields: [teacherId], references: [id])

  @@id([organizationId, teacherId])
  @@index([teacherId])
}

model Student {
  id String @id @unique @default(cuid())

  name    String @db.VarChar(255)
  address String @db.VarChar(255)
  phone   String @db.VarChar(255)
  city    String @db.VarChar(255)
  state   String @db.VarChar(255)
  country String @db.VarChar(255)
  email   String @unique @db.VarChar(255)

  profileId String
  profile   Profile @relation(fields: [profileId], references: [kindeId])

  organizations OrganizationStudent[]

  classrooms Classroom[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([profileId], name: "profileId")
  @@map("students")
}

model OrganizationStudent {
  organizationId String       @unique
  organization   Organization @relation(fields: [organizationId], references: [id])

  studentId String  @unique
  student   Student @relation(fields: [studentId], references: [id])

  @@id([organizationId, studentId])
  @@index([studentId])
}

model Classroom {
  id String @id @unique @default(cuid())

  name        String @db.VarChar(255)
  description String @db.Text

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  teachers Teacher[]
  students Student[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([organizationId], name: "organizationId")
  @@map("classrooms")
}

model Notification {
  id      String             @id @unique @default(cuid())
  type    NotificationType
  status  NotificationStatus @default(PENDING)
  message String

  recipientId   String
  recipientType NotificationUserType

  senderId   String
  senderType NotificationUserType

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([senderId, senderType], name: "sender")
  @@index([recipientId, recipientType], name: "recipient")
  @@map("notifications")
}
